# =============================================================================
# EQUIPPED TASK INDEX
# =============================================================================
# Master index for all development tasks. Read this before selecting tasks.
#
# TASK SELECTION RULES
# --------------------
# 1. Check `done: true` - skip completed tasks
# 2. Check `requires: human` - skip tasks needing manual action (see below)
# 3. Check `complexity` - match agent capability to task difficulty
# 4. Check Dependencies section in task file - complete prerequisites first
# 5. Respect epic `priority` - high > medium > low
#
# COMPLEXITY LEVELS
# -----------------
# Use complexity to match agent capability to task difficulty:
#
#   low:    Straightforward, well-defined, follows established patterns.
#           Use fast/cheap agents. Examples: static pages, loading states,
#           simple CRUD, footer updates.
#
#   medium: Standard implementation work, some decisions needed but patterns
#           exist. Use standard agents. Examples: dashboard views, list/detail
#           pages, form handling, API endpoints with clear specs.
#
#   high:   Requires research, architectural decisions, multiple integrations,
#           or security-sensitive code. Use advanced agents. Examples: auth
#           middleware, payment processing, external API integrations, schema
#           design, multi-tenant architecture.
#
# HUMAN-REQUIRED TASKS
# --------------------
# Tasks marked `requires: human` need real-world action and cannot be
# completed by agents. These include:
#
#   - External dashboard setup (Clerk, CloudFlare, Stripe, Plaid, PostHog)
#   - Partnership agreements (Macquarie, Upgraded)
#   - Account creation on third-party services
#   - API key generation from external providers
#
# When encountering these, inform the user what manual steps are needed.
# Do NOT attempt to complete these tasks automatically.
#
# ESCALATION PROTOCOL
# -------------------
# If an agent fails to complete a task:
#
#   1. Document the failure reason clearly
#   2. Report: "ESCALATION NEEDED: {task_id} - {reason}"
#   3. Suggest complexity upgrade if task was harder than rated
#   4. Do NOT mark the task as done
#   5. Do NOT attempt repeated retries without escalation
#
# Escalation reasons include:
#   - Task requires research not anticipated
#   - Architectural decisions needed beyond task scope
#   - Dependencies not met or discovered mid-task
#   - Security implications require senior review
#   - Integration complexity exceeded expectations
#
# TASK FILE FORMAT
# ----------------
# Each task file (tasks/{epic}/{task}.md) contains:
#   - Description: What needs to be done
#   - Acceptance Criteria: Checkboxes for deliverables
#   - Test Criteria: Gherkin BDD scenarios
#   - Dependencies: Other tasks that must complete first
#   - Implementation: Code examples where applicable
#   - References: Links to PRD.md and documentation/
#
# =============================================================================

version: 3
updated: 2024-12-08

epics:
  infrastructure:
    name: Infrastructure Setup
    description: Hono worker, wrangler config, deployment pipeline
    priority: high
    tasks:
      - id: setup-hono-worker
        name: Setup Hono Worker
        file: infrastructure/setup-hono-worker.md
        done: true
        complexity: medium
      - id: configure-wrangler
        name: Configure Wrangler for API
        file: infrastructure/configure-wrangler.md
        done: true
        complexity: medium
      - id: deploy-pipeline
        name: Verify Deploy Pipeline
        file: infrastructure/deploy-pipeline.md
        done: true
        complexity: low

  database:
    name: Database Setup
    description: Cloudflare D1 multi-tenant schema
    priority: high
    tasks:
      - id: create-d1-database
        name: Create D1 Database
        file: database/create-d1-database.md
        done: false
        complexity: low
        requires: human  # CloudFlare dashboard action
      - id: initial-schema
        name: Initial Database Schema (Multi-Tenant)
        file: database/initial-schema.md
        done: false
        complexity: high  # Architectural, multi-tenant design
      - id: run-migrations
        name: Run Database Migrations
        file: database/run-migrations.md
        done: false
        complexity: low

  multi-tenancy:
    name: Multi-Tenancy Architecture
    description: Subdomain routing and tenant isolation
    priority: high
    tasks:
      - id: subdomain-routing
        name: Subdomain-Based Routing
        file: multi-tenancy/subdomain-routing.md
        done: false
        complexity: high  # Architectural, routing logic
      - id: tenant-context
        name: Tenant Context Helper
        file: multi-tenancy/tenant-context.md
        done: false
        complexity: medium

  auth:
    name: Authentication
    description: Clerk authentication with multi-account support
    priority: high
    tasks:
      - id: install-clerk
        name: Install Clerk SDK
        file: auth/install-clerk.md
        done: false
        complexity: low
      - id: create-clerk-app
        name: Create Clerk Application
        file: auth/create-clerk-app.md
        done: false
        complexity: low
        requires: human  # Clerk dashboard setup
      - id: auth-pages
        name: Create Auth Pages
        file: auth/auth-pages.md
        done: true
        complexity: medium
      - id: clerk-provider
        name: Setup ClerkProvider
        file: auth/clerk-provider.md
        done: true
        complexity: medium
      - id: auth-navigation
        name: Update Navigation for Auth
        file: auth/auth-navigation.md
        done: false
        complexity: medium

  api:
    name: API Layer
    description: Hono API routes with tenant scoping
    priority: high
    tasks:
      - id: auth-middleware
        name: Auth Middleware
        file: api/auth-middleware.md
        done: false
        complexity: high  # Security-sensitive, RBAC
      - id: clerk-webhook
        name: Clerk Webhook Handler
        file: api/clerk-webhook.md
        done: false
        complexity: high  # Security, signature verification
      - id: device-crud
        name: Device CRUD Endpoints (Tenant-Scoped)
        file: api/device-crud.md
        done: false
        complexity: medium
      - id: user-endpoints
        name: User Profile Endpoints
        file: api/user-endpoints.md
        done: false
        complexity: medium

  commerce:
    name: Commerce & Checkout
    description: 4-stage checkout flow with leasing
    priority: high
    tasks:
      - id: cart-management
        name: Cart Management
        file: commerce/cart-management.md
        done: false
        complexity: medium
      - id: checkout-assignment
        name: "Checkout Stage 1: Assignment"
        file: commerce/checkout-assignment.md
        done: true
        complexity: medium
      - id: checkout-shipping
        name: "Checkout Stage 2: Shipping"
        file: commerce/checkout-shipping.md
        done: false
        complexity: medium
      - id: checkout-delivery
        name: "Checkout Stage 3: Delivery"
        file: commerce/checkout-delivery.md
        done: false
        complexity: medium
      - id: checkout-payment
        name: "Checkout Stage 4: Payment/Leasing"
        file: commerce/checkout-payment.md
        done: false
        complexity: high  # Payment processing, leasing integration

  orders:
    name: Order Management
    description: Order tracking and history
    priority: medium
    tasks:
      - id: order-list
        name: Order List View
        file: orders/order-list.md
        done: false
        complexity: medium
      - id: order-details
        name: Order Details View
        file: orders/order-details.md
        done: false
        complexity: medium

  people:
    name: People & Teams
    description: Employee directory and lifecycle workflows
    priority: medium
    tasks:
      - id: directory-view
        name: People Directory
        file: people/directory-view.md
        done: false
        complexity: medium
      - id: onboarding-workflow
        name: Onboarding Workflow
        file: people/onboarding-workflow.md
        done: false
        complexity: medium
      - id: offboarding-workflow
        name: Offboarding Workflow
        file: people/offboarding-workflow.md
        done: false
        complexity: medium

  proposals:
    name: B2B Proposals
    description: Quote creation and approval workflow
    priority: medium
    tasks:
      - id: create-proposal
        name: Create Proposal
        file: proposals/create-proposal.md
        done: false
        complexity: medium
      - id: view-proposal
        name: Public Proposal View
        file: proposals/view-proposal.md
        done: false
        complexity: medium

  trade-in:
    name: Device Trade-In
    description: Valuation, shipping, and credit processing
    priority: medium
    tasks:
      - id: device-valuation
        name: Device Valuation
        file: trade-in/device-valuation.md
        done: false
        complexity: high  # External API integration
      - id: return-shipping
        name: Return Shipping & Labels
        file: trade-in/return-shipping.md
        done: false
        complexity: medium

  fleet:
    name: Fleet Management
    description: Device inventory and assignment tracking
    priority: medium
    tasks:
      - id: device-inventory
        name: Device Inventory View
        file: fleet/device-inventory.md
        done: false
        complexity: medium
      - id: device-assignment
        name: Device Assignment
        file: fleet/device-assignment.md
        done: false
        complexity: medium

  settings:
    name: Organization Settings
    description: Account configuration and team management
    priority: medium
    tasks:
      - id: organization-settings
        name: Organization Settings
        file: settings/organization-settings.md
        done: false
        complexity: medium
      - id: team-access
        name: Team Access Management
        file: settings/team-access.md
        done: false
        complexity: medium

  sysadmin:
    name: Sys Admin Tools
    description: Equipped staff admin panel
    priority: low
    tasks:
      - id: admin-dashboard
        name: Admin Dashboard
        file: sysadmin/admin-dashboard.md
        done: false
        complexity: medium
      - id: customer-impersonation
        name: Customer Impersonation
        file: sysadmin/customer-impersonation.md
        done: false
        complexity: high  # Security-sensitive, audit logging

  monitoring:
    name: Monitoring & Observability
    description: Health checks, error tracking, analytics
    priority: medium
    tasks:
      - id: health-check
        name: Health Check Endpoint
        file: monitoring/health-check.md
        done: true
        complexity: low
      - id: error-tracking
        name: Sentry Error Tracking
        file: monitoring/error-tracking.md
        done: false
        complexity: medium

  dashboard:
    name: Dashboard UI
    description: Customer dashboard interface
    priority: medium
    tasks:
      - id: dashboard-layout
        name: Dashboard Layout
        file: dashboard/dashboard-layout.md
        done: true
        complexity: medium
      - id: sidebar-navigation
        name: Sidebar Navigation
        file: dashboard/sidebar-navigation.md
        done: true
        complexity: low
      - id: dashboard-home
        name: Dashboard Home Page
        file: dashboard/dashboard-home.md
        done: false
        complexity: medium
      - id: loading-states
        name: Loading States
        file: dashboard/loading-states.md
        done: true
        complexity: low
      - id: empty-states
        name: Empty States
        file: dashboard/empty-states.md
        done: true
        complexity: low

  static-pages:
    name: Static Pages
    description: Legal and informational pages
    priority: low
    tasks:
      - id: privacy-page
        name: Privacy Policy Page
        file: static-pages/privacy-page.md
        done: false
        complexity: low
      - id: terms-page
        name: Terms of Service Page
        file: static-pages/terms-page.md
        done: true
        complexity: low
      - id: update-footer
        name: Update Footer Links
        file: static-pages/update-footer.md
        done: false
        complexity: low

  integrations:
    name: External Integrations
    description: Third-party service integrations
    priority: medium
    tasks:
      - id: macquarie-leasing
        name: Macquarie Leasing API
        file: integrations/macquarie-leasing.md
        done: false
        complexity: high  # External API, financial
        requires: human  # Partnership setup
      - id: plaid-verification
        name: Plaid Bank Verification
        file: integrations/plaid-verification.md
        done: false
        complexity: high  # External API, financial
        requires: human  # Plaid account setup
      - id: upgraded-api
        name: Upgraded API (Fulfillment)
        file: integrations/upgraded-api.md
        done: false
        complexity: high  # External API, webhooks
        requires: human  # Partnership setup
      - id: posthog-analytics
        name: PostHog Analytics
        file: integrations/posthog-analytics.md
        done: false
        complexity: low
        requires: human  # PostHog project setup
      - id: shopify-api
        name: Shopify Store API
        file: integrations/shopify-api.md
        done: false
        complexity: high  # External API, product sync
      - id: stripe-payments
        name: Stripe Payments
        file: integrations/stripe-payments.md
        done: false
        complexity: high  # Payment processing
        requires: human  # Stripe account setup
      - id: alchemy-api
        name: Alchemy Device API
        file: integrations/alchemy-api.md
        done: false
        complexity: medium
      - id: spark-shipping
        name: Spark Shipping
        file: integrations/spark-shipping.md
        done: false
        complexity: medium
