# =============================================================================
# EQUIPPED TASK INDEX
# =============================================================================
# Master index for all development tasks. Read this before selecting tasks.
#
# TASK SELECTION RULES
# --------------------
# 1. Check `done: true` - skip completed tasks
# 2. Check `requires: human` - skip tasks needing manual action (see below)
# 3. Check `complexity` - match agent capability to task difficulty
# 4. Check Dependencies section in task file - complete prerequisites first
# 5. Respect epic `priority` - high > medium > low
#
# COMPLEXITY LEVELS
# -----------------
# Use complexity to match agent capability to task difficulty:
#
#   low:    Straightforward, well-defined, follows established patterns.
#           Use fast/cheap agents. Examples: static pages, loading states,
#           simple CRUD, footer updates.
#
#   medium: Standard implementation work, some decisions needed but patterns
#           exist. Use standard agents. Examples: dashboard views, list/detail
#           pages, form handling, API endpoints with clear specs.
#
#   high:   Requires research, architectural decisions, multiple integrations,
#           or security-sensitive code. Use advanced agents. Examples: auth
#           middleware, payment processing, external API integrations, schema
#           design, multi-tenant architecture.
#
# HUMAN-REQUIRED TASKS
# --------------------
# Tasks marked `requires: human` need real-world action and cannot be
# completed by agents. These include:
#
#   - External dashboard setup (Clerk, CloudFlare, Stripe, Plaid, PostHog)
#   - Partnership agreements (Macquarie, Upgraded)
#   - Account creation on third-party services
#   - API key generation from external providers
#
# When encountering these, inform the user what manual steps are needed.
# Do NOT attempt to complete these tasks automatically.
#
# COMMIT & VERSION TRACKING
# --------------------------
# AGENTS MUST commit changes frequently with comprehensive commit messages.
#
# Commit frequency:
#   - After EACH logical chunk of work (not just at task end)
#   - At least once per task
#   - Clear, descriptive message following conventional commits
#
# Commit message format (MANDATORY):
#   feat(epic): short description (50 chars max)
#
#   Detailed explanation of what changed and WHY.
#   Include acceptance criteria satisfied, files modified, testing done.
#
#   Examples:
#   - feat(auth): install Clerk SDK packages and configure environment
#   - feat(dashboard): add loading state components (Spinner, Skeleton, CardSkeleton)
#   - fix(auth-pages): correct Clerk provider configuration for production
#
# Task completion tracking:
#   When marking task as `done: true`, ALSO add `commit: {git-hash}`
#   This creates an audit trail of exactly when/what was implemented.
#
#   Example:
#     done: true
#     commit: 70f4386  # git log --oneline hash from implementation commit
#
# Benefits:
#   - Audit trail of all work (can revert individual tasks if needed)
#   - Traceability: who implemented what and when
#   - Debugging: link tests/issues to specific commits
#   - Progress tracking: see what changed in each commit
#
# ESCALATION PROTOCOL
# -------------------
# If an agent fails to complete a task:
#
#   1. Document the failure reason clearly
#   2. Report: "ESCALATION NEEDED: {task_id} - {reason}"
#   3. Suggest complexity upgrade if task was harder than rated
#   4. Do NOT mark the task as done
#   5. Do NOT attempt repeated retries without escalation
#   6. Update task with `escalation_reason: "{reason}"` field
#
# Escalation reasons include:
#   - Task requires research not anticipated
#   - Architectural decisions needed beyond task scope
#   - Dependencies not met or discovered mid-task (see depends_on array)
#   - Security implications require senior review
#   - Integration complexity exceeded expectations
#
# TASK DEPENDENCIES
# ------------------
# Each task declares its hard dependencies via `depends_on` array.
# This is NOT optional - it's critical for agent task selection.
#
# Format:
#   depends_on:
#     - {epic}/{task-id}    # Must be completed first
#
# Benefits:
#   - Agents can see blockers at-a-glance in this file
#   - Prevents work on tasks with incomplete prerequisites
#   - Enables automatic task ordering (topological sort)
#   - Quick validation that dependencies are satisfied
#
# Task selection logic:
#   1. Check task is not done: true
#   2. Check all tasks in depends_on are done: true
#   3. If dependencies not satisfied, report them clearly
#   4. If dependencies are missing/blocking, escalate with reason
#
# Example:
#   Task: device-crud (BLOCKED without these):
#     depends_on:
#       - api/auth-middleware        # Requires auth verification
#       - multi-tenancy/tenant-context  # Requires getTenantContext() helper
#       - database/run-migrations     # Requires devices table schema
#
# TEST EXECUTION PROTOCOL
# -----------------------
# ALL agents MUST run tests after completing any task. This is NOT optional.
#
# Test execution steps:
#   1. Run `bun run check` (Biome linting)
#   2. Run `bun run build` (TypeScript + Astro build)
#   3. Run any task-specific tests mentioned in the task file
#
# If tests FAIL:
#   1. Analyze the error - is it trivial (typo, import) or non-trivial?
#   2. For TRIVIAL errors: Fix immediately and re-run tests
#   3. For NON-TRIVIAL errors:
#      a. Create a failure task file: `{epic}/{task-id}-failure.md`
#      b. Document the error, stack trace, and attempted fixes
#      c. Add the failure task to this index under the same epic:
#         - id: {original-task-id}-failure
#           name: "Fix: {Original Task Name}"
#           file: {epic}/{task-id}-failure.md
#           done: false
#           complexity: high  # ALWAYS high - debugging is hard
#           blocks: {original-task-id}  # Original task blocked until fixed
#      d. Attempt to fix the error
#      e. If fix succeeds: mark failure task done, re-run tests
#      f. If fix fails: escalate with "ESCALATION NEEDED: {task-id}-failure"
#
# Failure task file format ({task-id}-failure.md):
#   ---
#   # Fix: {Original Task Name}
#
#   ## Original Task
#   - ID: {original-task-id}
#   - File: {epic}/{original-task}.md
#
#   ## Error Details
#   - Command: {what command failed}
#   - Exit Code: {code}
#   - Error Type: {build/lint/runtime/type}
#
#   ## Stack Trace
#   ```
#   {full error output}
#   ```
#
#   ## Analysis
#   {root cause analysis}
#
#   ## Attempted Fixes
#   1. {what was tried and why it failed}
#
#   ## Proposed Solution
#   {next steps to resolve}
#   ---
#
# TASK FILE FORMAT
# ----------------
# Each task file (tasks/{epic}/{task}.md) contains:
#   - Description: What needs to be done
#   - Acceptance Criteria: Checkboxes for deliverables
#   - Test Criteria: Gherkin BDD scenarios
#   - Dependencies: Other tasks that must complete first
#   - Implementation: Code examples where applicable
#   - References: Links to PRD.md and documentation/
#
# =============================================================================

version: 4
updated: 2025-12-10

epics:
  infrastructure:
    name: Infrastructure Setup
    description: Hono worker, wrangler config, deployment pipeline
    priority: high
    tasks:
      - id: setup-hono-worker
        name: Setup Hono Worker
        file: infrastructure/setup-hono-worker.md
        done: true
        commit: 2b14d81
        complexity: medium
        depends_on: []
      - id: configure-wrangler
        name: Configure Wrangler for API
        file: infrastructure/configure-wrangler.md
        done: true
        commit: 2b14d81
        complexity: medium
        depends_on:
          - infrastructure/setup-hono-worker
      - id: deploy-pipeline
        name: Verify Deploy Pipeline
        file: infrastructure/deploy-pipeline.md
        done: true
        commit: 2b14d81
        complexity: low
        depends_on:
          - infrastructure/setup-hono-worker
          - infrastructure/configure-wrangler

  database:
    name: Database Setup
    description: Cloudflare D1 multi-tenant schema
    priority: high
    tasks:
      - id: create-d1-database
        name: Create D1 Database
        file: database/create-d1-database.md
        done: true
        commit: 800b6d4
        complexity: low
        depends_on: []
      - id: initial-schema
        name: Initial Database Schema (Multi-Tenant)
        file: database/initial-schema.md
        done: true
        commit: e1b7338
        complexity: high  # Architectural, multi-tenant design
        depends_on:
          - database/create-d1-database
      - id: run-migrations
        name: Run Database Migrations
        file: database/run-migrations.md
        done: true
        commit: 800b6d4
        complexity: low
        depends_on:
          - database/initial-schema
      - id: fix-schema-naming
        name: Fix Schema Naming Consistency
        file: database/fix-schema-naming.md
        done: true
        commit: 11362b8
        complexity: low
        depends_on:
          - database/initial-schema

  multi-tenancy:
    name: Multi-Tenancy Architecture
    description: Subdomain routing and tenant isolation
    priority: high
    tasks:
      - id: subdomain-routing
        name: Subdomain-Based Routing
        file: multi-tenancy/subdomain-routing.md
        done: true
        commit: 1fbba78
        complexity: high  # Architectural, routing logic
        depends_on: []
      - id: tenant-context
        name: Tenant Context Helper
        file: multi-tenancy/tenant-context.md
        done: true
        commit: e915d45
        complexity: medium
        depends_on:
          - multi-tenancy/subdomain-routing

  auth:
    name: Authentication
    description: Clerk authentication with multi-account support
    priority: high
    tasks:
      - id: install-clerk
        name: Install Clerk SDK
        file: auth/install-clerk.md
        done: true
        commit: b004a6c
        complexity: low
        depends_on: []
      - id: create-clerk-app
        name: Create Clerk Application
        file: auth/create-clerk-app.md
        done: true  # Keys configured in .env.local
        complexity: low
        requires: human  # Clerk dashboard setup
        depends_on: []
      - id: auth-pages
        name: Create Auth Pages
        file: auth/auth-pages.md
        done: true
        commit: 70f4386
        complexity: medium
        depends_on:
          - auth/install-clerk
      - id: clerk-provider
        name: Setup ClerkProvider
        file: auth/clerk-provider.md
        done: true
        commit: 22a57f1
        complexity: medium
        depends_on:
          - auth/install-clerk
      - id: auth-navigation
        name: Update Navigation for Auth
        file: auth/auth-navigation.md
        done: true
        commit: afaaf2f
        complexity: medium
        depends_on:
          - auth/auth-pages
          - auth/clerk-provider

  invitations:
    name: Team Invitations
    description: Account invitation lifecycle (REQ-ID-005 to REQ-ID-008)
    priority: high
    tasks:
      - id: invitations-schema
        name: Account Invitations Table Migration
        file: invitations/invitations-schema.md
        done: true
        commit: 8d43f4b
        complexity: medium
        depends_on:
          - database/initial-schema
      - id: invitation-api
        name: Invitation API Endpoints
        file: invitations/invitation-api.md
        done: true
        commit: 15425a3
        complexity: high  # Security, lifecycle management
        depends_on:
          - invitations/invitations-schema
          - api/auth-middleware
      - id: invitation-ui
        name: Invitation UI Components
        file: invitations/invitation-ui.md
        done: true
        commit: 654a9b6
        complexity: medium
        depends_on:
          - invitations/invitation-api
          - settings/team-access
      - id: invitation-emails
        name: Invitation Email Templates
        file: invitations/invitation-emails.md
        done: true
        commit: a35f0b7
        complexity: low
        depends_on:
          - invitations/invitation-api
      - id: invitation-expiry
        name: Invitation Expiry Worker
        file: invitations/invitation-expiry.md
        done: true
        commit: 632f34d
        complexity: medium
        depends_on:
          - invitations/invitations-schema

  multi-account:
    name: Multi-Account Access
    description: Consultant pattern for users with multiple accounts (REQ-ID-011, REQ-ID-012)
    priority: high
    tasks:
      - id: account-switcher
        name: Account Switcher Component
        file: multi-account/account-switcher.md
        done: true
        commit: 943a490
        complexity: medium
        depends_on:
          - auth/clerk-provider
          - api/auth-middleware
      - id: account-list-api
        name: User Accounts API Endpoint
        file: multi-account/account-list-api.md
        done: true
        commit: 11362b8
        complexity: medium
        depends_on:
          - api/auth-middleware
      - id: set-primary-account
        name: Set Primary Account
        file: multi-account/set-primary-account.md
        done: true
        commit: 2beacaf
        complexity: low
        depends_on:
          - multi-account/account-list-api
          - api/user-endpoints

  catalog:
    name: Global Product Catalog
    description: Brands, products, and inventory management (Database Schema)
    priority: medium
    tasks:
      - id: catalog-schema
        name: Product Catalog Schema Migration
        file: catalog/catalog-schema.md
        done: true
        commit: 0b87d74
        complexity: medium
        depends_on:
          - database/initial-schema
      - id: catalog-seed-data
        name: Seed Brands and Products
        file: catalog/catalog-seed-data.md
        done: true
        commit: 89892ed
        complexity: low
        depends_on:
          - catalog/catalog-schema
      - id: catalog-api
        name: Catalog CRUD API Endpoints
        file: catalog/catalog-api.md
        done: true
        commit: 2beacaf
        complexity: medium
        depends_on:
          - catalog/catalog-schema
          - api/auth-middleware
      - id: catalog-admin-ui
        name: Catalog Admin UI (Sys Admin Only)
        file: catalog/catalog-admin-ui.md
        done: true
        commit: 654d3be
        complexity: medium
        depends_on:
          - catalog/catalog-api
          - sysadmin/admin-dashboard

  api:
    name: API Layer
    description: Hono API routes with tenant scoping
    priority: high
    tasks:
      - id: auth-middleware
        name: Auth Middleware
        file: api/auth-middleware.md
        done: true
        commit: 1fbba78
        complexity: high  # Security-sensitive, RBAC
        depends_on:
          - auth/install-clerk
          - multi-tenancy/subdomain-routing
      - id: clerk-webhook
        name: Clerk Webhook Handler
        file: api/clerk-webhook.md
        done: true
        commit: afaaf2f
        complexity: high  # Security, signature verification
        depends_on:
          - auth/install-clerk
          - api/auth-middleware
      - id: device-crud
        name: Device CRUD Endpoints (Tenant-Scoped)
        file: api/device-crud.md
        done: true
        commit: 74e77f3
        complexity: medium
        depends_on:
          - api/auth-middleware
          - multi-tenancy/tenant-context
          - database/run-migrations
      - id: user-endpoints
        name: User Profile Endpoints
        file: api/user-endpoints.md
        done: true
        commit: 337a2b5
        complexity: medium
        depends_on:
          - api/auth-middleware

  commerce:
    name: Commerce & Checkout
    description: 4-stage checkout flow with leasing
    priority: high
    tasks:
      - id: cart-management
        name: Cart Management
        file: commerce/cart-management.md
        done: true
        commit: cb0bb8d
        complexity: medium
        depends_on:
          - api/auth-middleware
      - id: checkout-assignment
        name: "Checkout Stage 1: Assignment"
        file: commerce/checkout-assignment.md
        done: true
        commit: bb2c75d
        complexity: medium
        depends_on:
          - auth/auth-pages
      - id: checkout-shipping
        name: "Checkout Stage 2: Shipping"
        file: commerce/checkout-shipping.md
        done: true
        commit: ff83b6d
        complexity: medium
        depends_on:
          - commerce/checkout-assignment
      - id: checkout-delivery
        name: "Checkout Stage 3: Delivery"
        file: commerce/checkout-delivery.md
        done: true
        commit: d6608a7
        complexity: medium
        depends_on:
          - commerce/checkout-shipping
      - id: checkout-payment
        name: "Checkout Stage 4: Payment/Leasing"
        file: commerce/checkout-payment.md
        done: true
        commit: 931385e
        complexity: high  # Payment processing, leasing integration
        depends_on:
          - commerce/checkout-delivery

  orders:
    name: Order Management
    description: Order tracking and history
    priority: medium
    tasks:
      - id: order-list
        name: Order List View
        file: orders/order-list.md
        done: true
        commit: 7c0899e
        complexity: medium
        depends_on:
          - api/device-crud
      - id: order-details
        name: Order Details View
        file: orders/order-details.md
        done: true
        commit: 187288f
        complexity: medium
        depends_on:
          - orders/order-list
          - api/device-crud

  people:
    name: People & Teams
    description: Employee directory and lifecycle workflows
    priority: medium
    tasks:
      - id: directory-view
        name: People Directory
        file: people/directory-view.md
        done: true
        commit: a422aba
        complexity: medium
        depends_on:
          - api/auth-middleware
          - api/user-endpoints
      - id: onboarding-workflow
        name: Onboarding Workflow
        file: people/onboarding-workflow.md
        done: true
        commit: 9b83674
        complexity: medium
        depends_on:
          - people/directory-view
      - id: offboarding-workflow
        name: Offboarding Workflow
        file: people/offboarding-workflow.md
        done: true
        commit: 187288f
        complexity: medium
        depends_on:
          - people/directory-view

  proposals:
    name: B2B Proposals
    description: Quote creation and approval workflow
    priority: medium
    tasks:
      - id: create-proposal
        name: Create Proposal
        file: proposals/create-proposal.md
        done: true
        commit: 8e19c91
        complexity: medium
        depends_on:
          - api/auth-middleware
      - id: view-proposal
        name: Public Proposal View
        file: proposals/view-proposal.md
        done: true
        commit: 1abfc48
        complexity: medium
        depends_on:
          - proposals/create-proposal

  trade-in:
    name: Device Trade-In
    description: Valuation, shipping, and credit processing
    priority: medium
    tasks:
      - id: device-valuation
        name: Device Valuation
        file: trade-in/device-valuation.md
        done: true
        commit: 43f633e
        complexity: high  # External API integration
        depends_on:
          - api/auth-middleware
          - multi-tenancy/tenant-context
      - id: return-shipping
        name: Return Shipping & Labels
        file: trade-in/return-shipping.md
        done: true
        commit: 3174704
        complexity: medium
        depends_on:
          - trade-in/device-valuation

  fleet:
    name: Fleet Management
    description: Device inventory and assignment tracking
    priority: medium
    tasks:
      - id: device-inventory
        name: Device Inventory View
        file: fleet/device-inventory.md
        done: true
        commit: 35436fe
        complexity: medium
        depends_on:
          - api/device-crud
      - id: device-assignment
        name: Device Assignment
        file: fleet/device-assignment.md
        done: true
        commit: 187288f
        complexity: medium
        depends_on:
          - fleet/device-inventory

  settings:
    name: Organization Settings
    description: Account configuration and team management
    priority: medium
    tasks:
      - id: organization-settings
        name: Organization Settings
        file: settings/organization-settings.md
        done: true
        commit: 75100cf
        complexity: medium
        depends_on:
          - api/auth-middleware
      - id: team-access
        name: Team Access Management
        file: settings/team-access.md
        done: true
        commit: 1abfc48
        complexity: medium
        depends_on:
          - settings/organization-settings

  sysadmin:
    name: Sys Admin Tools
    description: Equipped staff admin panel
    priority: low
    tasks:
      - id: admin-dashboard
        name: Admin Dashboard
        file: sysadmin/admin-dashboard.md
        done: true
        commit: 73e5463
        complexity: medium
        depends_on:
          - api/auth-middleware
      - id: customer-impersonation
        name: Customer Impersonation
        file: sysadmin/customer-impersonation.md
        done: true
        commit: cc49b6c
        complexity: high  # Security-sensitive, audit logging
        depends_on:
          - sysadmin/admin-dashboard
          - api/auth-middleware

  monitoring:
    name: Monitoring & Observability
    description: Health checks, error tracking, analytics
    priority: medium
    tasks:
      - id: health-check
        name: Health Check Endpoint
        file: monitoring/health-check.md
        done: true
        commit: 09f4fc3
        complexity: low
        depends_on:
          - infrastructure/setup-hono-worker
      - id: error-tracking
        name: Sentry Error Tracking
        file: monitoring/error-tracking.md
        done: true
        commit: 187288f
        complexity: medium
        depends_on:
          - monitoring/health-check

  dashboard:
    name: Dashboard UI
    description: Customer dashboard interface
    priority: medium
    tasks:
      - id: dashboard-layout
        name: Dashboard Layout
        file: dashboard/dashboard-layout.md
        done: true
        commit: 23d7bd4
        complexity: medium
        depends_on:
          - auth/clerk-provider
      - id: sidebar-navigation
        name: Sidebar Navigation
        file: dashboard/sidebar-navigation.md
        done: true
        commit: 23d7bd4
        complexity: low
        depends_on:
          - dashboard/dashboard-layout
      - id: dashboard-home
        name: Dashboard Home Page
        file: dashboard/dashboard-home.md
        done: true
        commit: 183f066
        complexity: medium
        depends_on:
          - dashboard/dashboard-layout
          - api/device-crud
      - id: loading-states
        name: Loading States
        file: dashboard/loading-states.md
        done: true
        commit: be55a8d
        complexity: low
        depends_on:
          - dashboard/dashboard-layout
      - id: empty-states
        name: Empty States
        file: dashboard/empty-states.md
        done: true
        commit: 05bcde5
        complexity: low
        depends_on:
          - dashboard/dashboard-layout

  static-pages:
    name: Static Pages
    description: Legal and informational pages
    priority: low
    tasks:
      - id: privacy-page
        name: Privacy Policy Page
        file: static-pages/privacy-page.md
        done: true
        commit: 5735580
        complexity: low
        depends_on: []
      - id: terms-page
        name: Terms of Service Page
        file: static-pages/terms-page.md
        done: true
        commit: 23d7bd4
        complexity: low
        depends_on: []
      - id: update-footer
        name: Update Footer Links
        file: static-pages/update-footer.md
        done: true
        commit: dfa5827
        complexity: low
        depends_on:
          - static-pages/privacy-page
          - static-pages/terms-page

  testing:
    name: Testing Infrastructure
    description: Vitest setup, unit/integration/regression tests
    priority: high
    tasks:
      - id: setup-vitest
        name: Setup Vitest Testing Infrastructure
        file: testing/setup-vitest.md
        done: true
        commit: 3c05dc4
        complexity: medium
        depends_on:
          - infrastructure/setup-hono-worker
      - id: auth-tests
        name: Write Tests for Auth System
        file: testing/auth-tests.md
        done: true
        commit: ffd8ebf
        complexity: high
        depends_on:
          - testing/setup-vitest
          - api/auth-middleware
      - id: integration-tests
        name: Write Integration Tests for API & Components
        file: testing/integration-tests.md
        done: true
        commit: a98a481
        complexity: high
        depends_on:
          - testing/setup-vitest
          - api/device-crud
      - id: regression-tests
        name: Establish Regression Testing & Bug Prevention
        file: testing/regression-tests.md
        done: true
        commit: ffd8ebf
        complexity: medium
        depends_on:
          - testing/setup-vitest
      - id: setup-playwright
        name: Setup Playwright E2E Testing
        file: testing/setup-playwright.md
        done: true
        commit: 31bf0cc
        complexity: medium
        depends_on:
          - testing/setup-vitest
          - auth/auth-pages
          - commerce/checkout-assignment
      - id: clerk-e2e-integration
        name: Integrate Clerk Testing with Playwright
        file: testing/clerk-e2e-integration.md
        done: true
        commit: 08fc9da
        complexity: medium
        depends_on:
          - testing/setup-playwright
          - auth/clerk-provider
      - id: e2e-auth-state
        name: E2E Authentication State Reuse
        file: testing/e2e-auth-state.md
        done: true
        commit: 558018b
        complexity: low
        depends_on:
          - testing/clerk-e2e-integration
      - id: e2e-otp-flows
        name: E2E Tests for OTP Verification Flows
        file: testing/e2e-otp-flows.md
        done: true
        commit: bb60c8a
        complexity: medium
        depends_on:
          - testing/clerk-e2e-integration
      - id: fix-drizzle-mocking
        name: Fix Drizzle ORM Test Mocking
        file: testing/fix-drizzle-mocking.md
        done: false  # Infrastructure complete, migrated 4 test files, ~12 remaining
        commit: e03686d  # Core infrastructure + 2 example migrations
        complexity: medium
        progress: "Infrastructure complete. Migrated 4/16 test files: brands.test.ts, invitation-expiry.test.ts (plus 2 prior). See MIGRATION_GUIDE.md for checklist."
        depends_on:
          - testing/setup-vitest

  integrations:
    name: External Integrations
    description: Third-party service integrations
    priority: medium
    tasks:
      - id: macquarie-leasing
        name: Macquarie Leasing API
        file: integrations/macquarie-leasing.md
        done: false
        complexity: high  # External API, financial
        requires: human  # Partnership setup
        depends_on:
          - commerce/checkout-payment
      - id: plaid-verification
        name: Plaid Bank Verification
        file: integrations/plaid-verification.md
        done: false
        complexity: high  # External API, financial
        requires: human  # Plaid account setup
        depends_on:
          - api/user-endpoints
      - id: upgraded-api
        name: Upgraded API (Fulfillment)
        file: integrations/upgraded-api.md
        done: false
        complexity: high  # External API, webhooks
        requires: human  # Partnership setup
        depends_on:
          - orders/order-list
      - id: posthog-analytics
        name: PostHog Analytics
        file: integrations/posthog-analytics.md
        done: false
        complexity: low
        requires: human  # PostHog project setup
        depends_on: []
      - id: shopify-api
        name: Shopify Store API
        file: integrations/shopify-api.md
        done: true
        commit: 9b83674
        complexity: high  # External API, product sync
        depends_on:
          - api/device-crud
      - id: stripe-payments
        name: Stripe Payments
        file: integrations/stripe-payments.md
        done: false
        complexity: high  # Payment processing
        requires: human  # Stripe account setup
        depends_on:
          - commerce/checkout-payment
      - id: alchemy-api
        name: Alchemy Device API
        file: integrations/alchemy-api.md
        done: true
        commit: 5df7c32
        complexity: medium
        depends_on: []
      - id: spark-shipping
        name: Spark Shipping
        file: integrations/spark-shipping.md
        done: true
        commit: a20c247
        complexity: medium
        depends_on:
          - trade-in/return-shipping
      - id: google-workspace-oauth
        name: Google Workspace OAuth Setup
        file: integrations/google-workspace-oauth.md
        done: false
        complexity: high  # OAuth integration, security
        requires: human  # Google Cloud Console setup
        depends_on:
          - api/auth-middleware
      - id: google-directory-sync
        name: Google Directory Sync
        file: integrations/google-directory-sync.md
        done: false
        complexity: high  # External API, data sync
        depends_on:
          - integrations/google-workspace-oauth
          - people/directory-view
      - id: addigy-integration
        name: Addigy MDM Integration
        file: integrations/addigy-integration.md
        done: false
        complexity: high  # External API, MDM setup wizard
        requires: human  # Addigy account setup
        depends_on:
          - fleet/device-inventory
      - id: mdm-device-sync
        name: MDM Device Sync Worker
        file: integrations/mdm-device-sync.md
        done: false
        complexity: medium
        depends_on:
          - integrations/addigy-integration
          - database/run-migrations

  bugs:
    name: Bug Fixes & Architecture Issues
    description: Critical fixes for architectural problems and bugs
    priority: high
    tasks:
      - id: dynamic-routing-poc
        name: POC - Dynamic Routing Strategy
        file: bugs/dynamic-routing-poc.md
        done: true
        commit: 99b49ca
        complexity: high
        depends_on: []
      - id: order-details-static-routes
        name: Fix Order Details Static Routes
        file: bugs/order-details-static-routes.md
        done: true
        commit: 8e0d145
        complexity: high
        depends_on:
          - bugs/dynamic-routing-poc
      - id: audit-dynamic-astro-routes
        name: Audit All Dynamic Astro Routes
        file: bugs/audit-dynamic-astro-routes.md
        done: true
        commit: 250eaed
        complexity: medium
        depends_on:
          - bugs/order-details-static-routes
      - id: fix-api-tests
        name: Fix API Route Tests (41 failures)
        file: bugs/fix-api-tests.md
        done: true
        commit: 4369ad2
        complexity: medium
        depends_on: []
      - id: fix-checkout-tests
        name: Fix Checkout & Cart Tests (22 failures)
        file: bugs/fix-checkout-tests.md
        done: true
        commit: 1cea39d
        complexity: medium
        depends_on: []
      - id: fix-people-tests
        name: Fix People/Onboarding Tests (6 failures)
        file: bugs/fix-people-tests.md
        done: true
        commit: 5d2a1b7
        complexity: medium
        depends_on: []
      - id: fix-settings-tests
        name: Fix Settings Component Tests (5 failures)
        file: bugs/fix-settings-tests.md
        done: true
        commit: 7ee64e2
        complexity: low
        depends_on: []
      - id: fix-admin-tests
        name: Fix Admin Component Tests (10 failures)
        file: bugs/fix-admin-tests.md
        done: true
        commit: 7ee64e2
        complexity: medium
        depends_on: []
      - id: fix-navigation-tests
        name: Fix Navigation Component Tests (7 failures)
        file: bugs/fix-navigation-tests.md
        done: true
        commit: 34ca391
        complexity: medium
        depends_on: []
      - id: fix-lib-tests
        name: Fix Library/Core Tests (3 failures)
        file: bugs/fix-lib-tests.md
        done: true
        commit: 07a66d7
        complexity: low
        depends_on: []
      - id: fix-vitest-dom-environment
        name: Fix Vitest DOM Environment (489 failures)
        file: bugs/fix-vitest-dom-environment.md
        done: true
        commit: 8b00e6f
        complexity: medium
        depends_on:
          - testing/setup-vitest
      - id: fix-vitest-api-changes
        name: Update Tests for Vitest 4.x API Changes (75 failures)
        file: bugs/fix-vitest-api-changes.md
        done: true
        commit: 9084bed
        complexity: low
        depends_on:
          - testing/setup-vitest
      - id: exclude-e2e-from-vitest
        name: Exclude Playwright E2E Tests from Vitest (3 failures)
        file: bugs/exclude-e2e-from-vitest.md
        done: true
        commit: 9084bed
        complexity: low
        depends_on:
          - testing/setup-playwright

  workflow:
    name: Workflow & Process Improvements
    description: Development processes, automation, and decision frameworks
    priority: medium
    tasks:
      - id: prd-preparation
        name: PRD Preparation Checklist
        file: workflow/prd-preparation.md
        done: true
        commit: 92762eb
        complexity: low
        depends_on: []
      - id: task-generation
        name: Automated Task Generation from PRD
        file: workflow/task-generation.md
        done: true
        commit: 1c0bce5
        complexity: medium
        depends_on:
          - workflow/prd-preparation
      - id: dependency-validation
        name: Enhanced Task Dependency Validation
        file: workflow/dependency-validation.md
        done: false
        complexity: low
        depends_on:
          - workflow/task-generation
      - id: testing-strategy
        name: Testing Strategy Decision Tree
        file: workflow/testing-strategy.md
        done: false
        complexity: low
        depends_on: []
      - id: rollback-procedures
        name: Rollback and Recovery Runbook
        file: workflow/rollback-procedures.md
        done: true
        commit: 1e35865
        complexity: medium
        depends_on: []
      - id: synthetic-isolation
        name: Synthetic Test Data Isolation Patterns
        file: workflow/synthetic-isolation.md
        done: false
        complexity: medium
        depends_on:
          - workflow/testing-strategy
      - id: env-var-strategy
        name: Environment Variable Management Strategy
        file: workflow/env-var-strategy.md
        done: true
        commit: c70cc52
        complexity: medium
        depends_on:
          - workflow/testing-strategy
          - testing/setup-vitest
          - testing/setup-playwright
          - testing/clerk-e2e-integration
