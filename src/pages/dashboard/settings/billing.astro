---
import { AlertCircle, ChevronLeft, CreditCard, Download } from 'lucide-react'
import DashboardLayout from '@/layouts/DashboardLayout.astro'

// Mock billing data (will be replaced with real API call)
const billingInfo = {
	stripe_customer_id: 'cus_123456',
	billing_email: 'billing@acme.com',
}

const usage = {
	devices: 15,
	users: 5,
}

const currentPlan = {
	name: 'Professional',
	price: 29,
	interval: 'month',
	features: ['Up to 50 devices', 'Unlimited users', 'Device provisioning', 'Asset tracking', 'Priority support'],
}

const invoices = [
	{
		id: 'inv_001',
		date: '2025-01-01',
		amount: 435.0,
		status: 'paid',
		downloadUrl: '#',
	},
	{
		id: 'inv_002',
		date: '2024-12-01',
		amount: 435.0,
		status: 'paid',
		downloadUrl: '#',
	},
	{
		id: 'inv_003',
		date: '2024-11-01',
		amount: 435.0,
		status: 'paid',
		downloadUrl: '#',
	},
]
---

<DashboardLayout title="Billing">
	<div class="max-w-4xl mx-auto space-y-8">
		<div class="mb-6">
			<a
				href="/dashboard/settings"
				class="inline-flex items-center text-sm text-muted-foreground hover:text-foreground"
			>
				<ChevronLeft size={16} class="mr-1" />
				Back to Settings
			</a>
		</div>

		<div>
			<h2 class="text-2xl font-bold">Billing & Subscription</h2>
			<p class="text-muted-foreground mt-1">Manage your subscription, payment methods, and invoices</p>
		</div>

		<!-- Current Plan -->
		<div class="border rounded-lg p-6">
			<h3 class="text-lg font-semibold mb-4">Current Plan</h3>
			<div class="flex items-start justify-between">
				<div>
					<div class="flex items-baseline gap-2">
						<span class="text-3xl font-bold">${currentPlan.price}</span>
						<span class="text-muted-foreground">/ {currentPlan.interval}</span>
					</div>
					<p class="text-sm text-muted-foreground mt-1">{currentPlan.name} Plan</p>

					<ul class="mt-4 space-y-2">
						{
							currentPlan.features.map(feature => (
								<li class="text-sm text-muted-foreground">
									<svg
										class="inline-block w-4 h-4 mr-2 text-green-600"
										fill="none"
										stroke="currentColor"
										viewBox="0 0 24 24"
									>
										<path
											stroke-linecap="round"
											stroke-linejoin="round"
											stroke-width="2"
											d="M5 13l4 4L19 7"
										/>
									</svg>
									{feature}
								</li>
							))
						}
					</ul>
				</div>
				<button
					class="px-4 py-2 border rounded-lg text-sm font-medium hover:bg-muted transition-colors"
				>
					Change Plan
				</button>
			</div>
		</div>

		<!-- Usage Stats -->
		<div class="border rounded-lg p-6">
			<h3 class="text-lg font-semibold mb-4">Usage</h3>
			<div class="grid grid-cols-2 gap-6">
				<div>
					<p class="text-sm text-muted-foreground">Devices Managed</p>
					<p class="text-3xl font-bold mt-1">{usage.devices}</p>
				</div>
				<div>
					<p class="text-sm text-muted-foreground">Team Members</p>
					<p class="text-3xl font-bold mt-1">{usage.users}</p>
				</div>
			</div>
		</div>

		<!-- Payment Method -->
		<div class="border rounded-lg p-6">
			<h3 class="text-lg font-semibold mb-4">Payment Method</h3>
			<div class="flex items-center justify-between">
				<div class="flex items-center gap-4">
					<div class="p-3 rounded-lg bg-primary/10 text-primary">
						<CreditCard size={24} />
					</div>
					<div>
						<p class="font-medium">Visa ending in 4242</p>
						<p class="text-sm text-muted-foreground">Expires 12/2026</p>
					</div>
				</div>
				<button
					class="px-4 py-2 border rounded-lg text-sm font-medium hover:bg-muted transition-colors"
				>
					Update Card
				</button>
			</div>

			<div class="mt-4 p-3 bg-muted rounded-lg flex items-start gap-3">
				<AlertCircle size={16} class="text-muted-foreground mt-0.5" />
				<p class="text-sm text-muted-foreground">
					Billing email: <strong>{billingInfo.billing_email}</strong>
					<a href="/dashboard/settings/organization" class="ml-2 text-primary hover:underline">
						Update
					</a>
				</p>
			</div>
		</div>

		<!-- Billing History -->
		<div class="border rounded-lg p-6">
			<h3 class="text-lg font-semibold mb-4">Billing History</h3>
			<div class="overflow-x-auto">
				<table class="w-full">
					<thead>
						<tr class="border-b">
							<th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Date</th>
							<th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Invoice</th>
							<th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Amount</th>
							<th class="text-left py-3 px-4 text-sm font-medium text-muted-foreground">Status</th>
							<th class="text-right py-3 px-4 text-sm font-medium text-muted-foreground">
								Download
							</th>
						</tr>
					</thead>
					<tbody>
						{
							invoices.map(invoice => (
								<tr class="border-b last:border-0 hover:bg-muted/50 transition-colors">
									<td class="py-3 px-4 text-sm">{invoice.date}</td>
									<td class="py-3 px-4 text-sm font-mono">{invoice.id}</td>
									<td class="py-3 px-4 text-sm">${invoice.amount.toFixed(2)}</td>
									<td class="py-3 px-4">
										<span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-700">
											{invoice.status}
										</span>
									</td>
									<td class="py-3 px-4 text-right">
										<a
											href={invoice.downloadUrl}
											class="inline-flex items-center text-sm text-primary hover:underline"
										>
											<Download size={16} class="mr-1" />
											PDF
										</a>
									</td>
								</tr>
							))
						}
					</tbody>
				</table>
			</div>
		</div>
	</div>
</DashboardLayout>
