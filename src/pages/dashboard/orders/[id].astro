---
import { OrderDetails } from '@/components/orders/OrderDetails'
import DashboardLayout from '@/layouts/DashboardLayout.astro'
import type { OrderWithItems } from '@/lib/scoped-queries'

// Generate static paths for all mock orders
export function getStaticPaths() {
	// Mock data - in production this would come from the database
	const mockOrders = [
		{ id: 'ord_1234567890abcdef' },
		{ id: 'ord_2345678901bcdefg' },
		{ id: 'ord_3456789012cdefgh' },
		{ id: 'ord_4567890123defghi' },
	]

	return mockOrders.map((order) => ({
		params: { id: order.id.slice(0, 8) },
	}))
}

// Get the order ID from the URL
const { id } = Astro.params

// Mock data for demonstration
// In production, this would come from the database via an API endpoint
const mockOrders: OrderWithItems[] = [
	{
		id: 'ord_1234567890abcdef',
		account_id: 'acc_demo',
		created_by_user_id: 'user_alice',
		assigned_to_person_id: 'person_bob',
		status: 'shipped',
		payment_method: 'card',
		subtotal: 2499.0,
		shipping_cost: 0,
		tax_amount: 224.91,
		total: 2723.91,
		shipping_address: '123 Main Street',
		shipping_city: 'San Francisco',
		shipping_state: 'CA',
		shipping_zip: '94105',
		shipping_country: 'US',
		tracking_number: '1Z999AA10123456784',
		carrier: 'UPS',
		estimated_delivery: '2025-12-15T18:00:00Z',
		created_at: '2025-12-01T10:30:00Z',
		updated_at: '2025-12-02T14:22:00Z',
		creator_name: 'Alice Johnson',
		assignee_name: 'Bob Smith',
		items: [
			{
				id: 'item_1',
				order_id: 'ord_1234567890abcdef',
				product_name: 'MacBook Pro 14" M4',
				product_sku: 'MBP-14-M4-16-512',
				quantity: 1,
				unit_price: 2499.0,
				total_price: 2499.0,
				specs: '16GB RAM, 512GB SSD, Space Black',
			},
		],
	},
	{
		id: 'ord_2345678901bcdefg',
		account_id: 'acc_demo',
		created_by_user_id: 'user_alice',
		status: 'pending_leasing_approval',
		payment_method: 'leasing',
		subtotal: 4998.0,
		shipping_cost: 0,
		tax_amount: 449.82,
		total: 5447.82,
		monthly_cost: 226.16,
		shipping_address: '456 Tech Avenue',
		shipping_city: 'Austin',
		shipping_state: 'TX',
		shipping_zip: '78701',
		shipping_country: 'US',
		created_at: '2025-12-05T14:22:00Z',
		creator_name: 'Alice Johnson',
		items: [
			{
				id: 'item_2',
				order_id: 'ord_2345678901bcdefg',
				product_name: 'MacBook Pro 14" M4',
				product_sku: 'MBP-14-M4-16-512',
				quantity: 2,
				unit_price: 2499.0,
				monthly_price: 113.08,
				total_price: 4998.0,
				specs: '16GB RAM, 512GB SSD, Space Black',
			},
		],
	},
	{
		id: 'ord_3456789012cdefgh',
		account_id: 'acc_demo',
		created_by_user_id: 'user_carol',
		assigned_to_person_id: 'person_david',
		status: 'delivered',
		payment_method: 'card',
		subtotal: 1599.0,
		shipping_cost: 0,
		tax_amount: 143.91,
		total: 1742.91,
		shipping_address: '789 Innovation Drive',
		shipping_city: 'Seattle',
		shipping_state: 'WA',
		shipping_zip: '98101',
		shipping_country: 'US',
		tracking_number: '1Z999AA10123456785',
		carrier: 'UPS',
		delivered_at: '2025-11-28T16:45:00Z',
		created_at: '2025-11-20T09:15:00Z',
		updated_at: '2025-11-28T16:45:00Z',
		creator_name: 'Carol Williams',
		assignee_name: 'David Lee',
		items: [
			{
				id: 'item_3',
				order_id: 'ord_3456789012cdefgh',
				product_name: 'iPad Pro 11" M4',
				product_sku: 'IPAD-11-M4-256',
				quantity: 1,
				unit_price: 1599.0,
				total_price: 1599.0,
				specs: '256GB, Wi-Fi + Cellular, Space Gray',
			},
		],
	},
	{
		id: 'ord_4567890123defghi',
		account_id: 'acc_demo',
		created_by_user_id: 'user_alice',
		status: 'processing',
		payment_method: 'card',
		subtotal: 529.0,
		shipping_cost: 15.0,
		tax_amount: 48.96,
		total: 592.96,
		shipping_address: '321 Developer Lane',
		shipping_city: 'New York',
		shipping_state: 'NY',
		shipping_zip: '10001',
		shipping_country: 'US',
		created_at: '2025-12-07T11:00:00Z',
		creator_name: 'Alice Johnson',
		items: [
			{
				id: 'item_4',
				order_id: 'ord_4567890123defghi',
				product_name: 'AirPods Pro (2nd gen)',
				product_sku: 'AIRPODS-PRO-2',
				quantity: 2,
				unit_price: 249.0,
				total_price: 498.0,
			},
			{
				id: 'item_5',
				order_id: 'ord_4567890123defghi',
				product_name: 'Magic Keyboard with Touch ID',
				product_sku: 'MK-TOUCH-ID',
				quantity: 1,
				unit_price: 149.0,
				total_price: 149.0,
			},
		],
	},
]

// Find the order by ID (match first 8 chars since we display shortened IDs)
const order = mockOrders.find(o => o.id.startsWith(id || ''))

// If order not found, return 404
if (!order) {
	return Astro.redirect('/dashboard/orders')
}
---

<DashboardLayout title={`Order ${order.id.slice(0, 8).toUpperCase()}`}>
	<div class="space-y-6">
		<!-- Back to Orders -->
		<a
			href="/dashboard/orders"
			class="inline-flex items-center gap-2 text-sm text-muted-foreground hover:text-foreground transition-colors"
		>
			<svg class="w-4 h-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
				<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"></path>
			</svg>
			Back to Orders
		</a>

		<!-- Order Details Component -->
		<OrderDetails order={order} client:only="react" />
	</div>
</DashboardLayout>

<script>
	// Client-side action handlers
	// In production, these would make API calls to the backend

	// Expose global functions for the React component to call
	if (typeof window !== 'undefined') {
		;(window as any).handleOrderCancel = async (orderId: string) => {
			console.log('Cancel order:', orderId)
			// TODO: API call to cancel order
			alert('Order cancellation functionality will be implemented in the API')
		}

		;(window as any).handleOrderReturn = async (orderId: string) => {
			console.log('Return order:', orderId)
			// TODO: API call to request return
			alert('Order return functionality will be implemented in the API')
		}

		;(window as any).handleOrderReorder = async (orderId: string) => {
			console.log('Reorder:', orderId)
			// TODO: API call to reorder
			alert('Reorder functionality will be implemented in the API')
		}

		;(window as any).handleDownloadInvoice = async (orderId: string) => {
			console.log('Download invoice:', orderId)
			// TODO: Generate and download PDF invoice
			alert('Invoice download functionality will be implemented')
		}
	}
</script>
